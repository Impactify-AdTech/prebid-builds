{"version":3,"file":"bidResponseFilter.js","mappings":";;;;;;;;;;;;;;AAAgE;AAAH;AAChB;AACD;AAErC,MAAMK,WAAW,GAAG,mBAAmB;AACvC,MAAMC,6BAA6B,GAAG,yBAAyB;AAC/D,MAAMC,gCAAgC,GAAG,2BAA2B;AACpE,MAAMC,yBAAyB,GAAG,qBAAqB;AAE9D,SAASC,IAAIA,CAAA,EAAG;EACdL,qDAAO,CAAC,gBAAgB,CAAC,CAACM,MAAM,CAACC,kBAAkB,CAAC;AACtD;AAAC;AAEM,SAASA,kBAAkBA,CAACC,IAAI,EAAEC,UAAU,EAAEC,GAAG,EAAEC,MAAM,EAAgC;EAAA,IAA9BC,KAAK,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAGf,kEAAc,CAACc,KAAK;EAC5F,MAAM;IAACI,IAAI,GAAG,EAAE;IAAEC,IAAI,GAAG;EAAE,CAAC,GAAGL,KAAK,CAACM,QAAQ,CAACR,GAAG,CAAC,IAAI,CAAC,CAAC;EACxD,MAAMS,KAAK,GAAGP,KAAK,CAACQ,aAAa,CAACV,GAAG,CAAC,EAAEW,QAAQ,CAACX,GAAG,CAACY,SAAS,CAAC,EAAEH,KAAK,IAAIP,KAAK,CAACW,SAAS,CAACb,GAAG,CAAC,EAAEW,QAAQ,CAACX,GAAG,CAACY,SAAS,CAAC,EAAEH,KAAK,IAAI,EAAE;EACpI,MAAMK,YAAY,GAAGzB,kDAAM,CAAC0B,SAAS,CAACxB,WAAW,CAAC;EAElD,MAAMyB,SAAS,GAAG;IAACC,OAAO,EAAE,IAAI;IAAEC,YAAY,EAAE,IAAI;IAAE,IAAIJ,YAAY,EAAEK,GAAG,IAAI,CAAC,CAAC;EAAC,CAAC;EACnF,MAAMC,SAAS,GAAG;IAACH,OAAO,EAAE,IAAI;IAAEC,YAAY,EAAE,IAAI;IAAE,IAAIJ,YAAY,EAAEO,GAAG,IAAI,CAAC,CAAC;EAAC,CAAC;EACnF,MAAMC,UAAU,GAAG;IAACL,OAAO,EAAE,IAAI;IAAEC,YAAY,EAAE,IAAI;IAAE,IAAIJ,YAAY,EAAES,IAAI,IAAI,CAAC,CAAC;EAAC,CAAC;EAErF,MAAM;IAAEC,YAAY;IAAEC,eAAe,GAAG,EAAE;IAAEC,iBAAiB,GAAG,EAAE;IAAEH,IAAI,EAAEI;EAAS,CAAC,GAAG3B,GAAG,CAAC4B,IAAI,IAAI,CAAC,CAAC;;EAErG;EACA,IAAKZ,SAAS,CAACC,OAAO,IAAIX,IAAI,CAACuB,IAAI,CAACC,QAAQ,IAAI,CAACN,YAAY,EAAE,GAAGC,eAAe,CAAC,CAACM,QAAQ,CAACD,QAAQ,CAAC,CAAC,IACnGd,SAAS,CAACE,YAAY,IAAI,CAACM,YAAa,EAAE;IAC3CvB,MAAM,CAACT,6BAA6B,CAAC;EACvC,CAAC,MAAM,IAAK4B,SAAS,CAACH,OAAO,IAAIV,IAAI,CAACsB,IAAI,CAACG,MAAM,IAAIN,iBAAiB,CAACK,QAAQ,CAACC,MAAM,CAAC,CAAC,IACrFZ,SAAS,CAACF,YAAY,IAAI,CAACQ,iBAAiB,CAACtB,MAAO,EAAE;IACvDH,MAAM,CAACR,gCAAgC,CAAC;EAC1C,CAAC,MAAM,IAAK6B,UAAU,CAACL,OAAO,IAAIR,KAAK,CAACsB,QAAQ,CAACJ,QAAQ,CAAC,IACvDL,UAAU,CAACJ,YAAY,IAAI,CAACS,QAAS,EAAE;IACxC1B,MAAM,CAACP,yBAAyB,CAAC;EACnC,CAAC,MAAM;IACL,OAAOI,IAAI,CAACC,UAAU,EAAEC,GAAG,EAAEC,MAAM,CAAC;EACtC;AACF;AAEAN,IAAI,CAAC,CAAC;AAvCNR,oEAAI,CAAC,mBAAmB,CAAC","sources":["webpack://prebid.js/./modules/bidResponseFilter/index.js"],"sourcesContent":["import { auctionManager } from '../../src/auctionManager.js';\nimport { config } from '../../src/config.js';\nimport { getHook } from '../../src/hook.js';\n\nexport const MODULE_NAME = 'bidResponseFilter';\nexport const BID_CATEGORY_REJECTION_REASON = 'Category is not allowed';\nexport const BID_ADV_DOMAINS_REJECTION_REASON = 'Adv domain is not allowed';\nexport const BID_ATTR_REJECTION_REASON = 'Attr is not allowed';\n\nfunction init() {\n  getHook('addBidResponse').before(addBidResponseHook);\n};\n\nexport function addBidResponseHook(next, adUnitCode, bid, reject, index = auctionManager.index) {\n  const {bcat = [], badv = []} = index.getOrtb2(bid) || {};\n  const battr = index.getBidRequest(bid)?.ortb2Imp[bid.mediaType]?.battr || index.getAdUnit(bid)?.ortb2Imp[bid.mediaType]?.battr || [];\n  const moduleConfig = config.getConfig(MODULE_NAME);\n\n  const catConfig = {enforce: true, blockUnknown: true, ...(moduleConfig?.cat || {})};\n  const advConfig = {enforce: true, blockUnknown: true, ...(moduleConfig?.adv || {})};\n  const attrConfig = {enforce: true, blockUnknown: true, ...(moduleConfig?.attr || {})};\n\n  const { primaryCatId, secondaryCatIds = [], advertiserDomains = [], attr: metaAttr } = bid.meta || {};\n\n  // checking if bid fulfills ortb2 fields rules\n  if ((catConfig.enforce && bcat.some(category => [primaryCatId, ...secondaryCatIds].includes(category))) ||\n    (catConfig.blockUnknown && !primaryCatId)) {\n    reject(BID_CATEGORY_REJECTION_REASON);\n  } else if ((advConfig.enforce && badv.some(domain => advertiserDomains.includes(domain))) ||\n    (advConfig.blockUnknown && !advertiserDomains.length)) {\n    reject(BID_ADV_DOMAINS_REJECTION_REASON);\n  } else if ((attrConfig.enforce && battr.includes(metaAttr)) ||\n    (attrConfig.blockUnknown && !metaAttr)) {\n    reject(BID_ATTR_REJECTION_REASON);\n  } else {\n    return next(adUnitCode, bid, reject);\n  }\n}\n\ninit();\n"],"names":["registerModule","__r0","auctionManager","config","getHook","MODULE_NAME","BID_CATEGORY_REJECTION_REASON","BID_ADV_DOMAINS_REJECTION_REASON","BID_ATTR_REJECTION_REASON","init","before","addBidResponseHook","next","adUnitCode","bid","reject","index","arguments","length","undefined","bcat","badv","getOrtb2","battr","getBidRequest","ortb2Imp","mediaType","getAdUnit","moduleConfig","getConfig","catConfig","enforce","blockUnknown","cat","advConfig","adv","attrConfig","attr","primaryCatId","secondaryCatIds","advertiserDomains","metaAttr","meta","some","category","includes","domain"],"sourceRoot":""}